# apiVersion: serving.knative.dev/v1
# kind: Service
# metadata:
#   name: petclinic01
#   annotations:
#     run.googleapis.com/launch-stage: BETA
# spec:
#   template:
#     metadata:
#       annotations:
#         run.googleapis.com/container-dependencies: "{app:[collector]}"
#     spec:
#       containers:
#       - image: asia-east1-docker.pkg.dev/careful-striker-429807-p1/run-otel/spring-petclinic:10.10.10
#         name: app
#         ports:
#         - containerPort: 8080
#         # env:
#         # - name: "OTEL_EXPORTER_OTLP_ENDPOINT"
#         #   value: "http://localhost:4317"
#         env:
#         - name: OTEL_EXPORTER_OTLP_ENDPOINT
#           value: http://collector:4317
#         - name: OTEL_LOGS_EXPORTER
#           value: otlp
#         - name: OTEL_METRICS_EXPORTER
#           value: otlp
#         - name: OTEL_RESOURCE_ATTRIBUTES
#           value: service=pet-service,env=dev
#         - name: OTEL_SERVICE_NAME
#           value: pet-service
#         - name: OTEL_TRACES_EXPORTER
#           value: otlp

#       - image: asia-east1-docker.pkg.dev/careful-striker-429807-p1/run-otel/opentel
#         - args:
#               - --config=/etc/otelcol-contrib/otel-collector.yml
#         name: collector
#         ports:
#           ports:
#             - containerPort: 4317
#               protocol: TCP
#             - containerPort: 8888
#               protocol: TCP
#         startupProbe:
#           httpGet:
#             path: /
#             port: 13133

apiVersion: serving.knative.dev/v1
kind: Service
metadata:
  name: petclinic05
  annotations:
    run.googleapis.com/launch-stage: BETA
spec:
  template:
    metadata:
      annotations:
        run.googleapis.com/container-dependencies: "{app:[collector]}"
    spec:
      containers:
      - image: asia-east1-docker.pkg.dev/careful-striker-429807-p1/open/spring-petclinic:10.10.10
        name: app
        ports:
        - containerPort: 8080
        env:
          name: "OTEL_EXPORTER_OTLP_ENDPOINT"
          value: "http://localhost:4317"
      - image: asia-east1-docker.pkg.dev/careful-striker-429807-p1/open/otel/opentelemetry-collector-contrib:0.91.0
        name: collector
        startupProbe:
          httpGet:
            path: /
            port: 13133

